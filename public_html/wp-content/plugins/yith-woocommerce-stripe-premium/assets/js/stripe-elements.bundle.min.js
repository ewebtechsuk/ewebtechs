(()=>{"use strict";var u,y,r,a,l,c,_,s,d,b,f,v,n,o,e,t,g,p,h,i,w,m,k,S={r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},C={};function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r,a,l=[],c=!0,s=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=r.call(n)).done)&&(l.push(i.value),l.length!==t);c=!0);}catch(e){s=!0,o=e}finally{try{if(!c&&null!=n["return"]&&(a=n["return"](),Object(a)!==a))return}finally{if(s)throw o}}return l}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||j(e,t)||function(e,t){var n;if(e)return"string"==typeof e?O(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}S.r(C),u=jQuery,l=u("body"),c={base:{backgroundColor:yith_stripe_info.background_color,fontSize:yith_stripe_info.font_size,color:yith_stripe_info.color,iconColor:yith_stripe_info.icon_color,fontFamily:yith_stripe_info.font_family,"::placeholder":{color:yith_stripe_info.placeholder_color}},invalid:{iconColor:yith_stripe_info.invalid_icon_color,color:yith_stripe_info.invalid_color},complete:{color:yith_stripe_info.complete_color}},_=Stripe(yith_stripe_info.public_key),s=_.elements(),d=function d(){var e,t,n,i,o;u(yith_stripe_info.elements_container_id).length?(void 0!==y&&y.destroy(),(y=s.create("card",{style:c,hidePostalCode:!yith_stripe_info.show_zip})).mount(yith_stripe_info.elements_container_id)):(e=u("#yith-stripe-card-number"),t=u("#yith-stripe-card-expiry"),n=u("#yith-stripe-card-cvc"),i=function i(e){e.complete&&("cardNumber"===e.elementType?r:a).focus()},e.length&&(o=e.attr("placeholder"),void 0!==y&&y.destroy(),y=s.create("cardNumber",{style:c,placeholder:o,showIcon:!0}),e.replaceWith('<div id="yith-stripe-card-number" class="yith-stripe-elements-field">'),y.mount("#yith-stripe-card-number"),y.on("change",i)),t.length&&(o=t.attr("placeholder"),void 0!==r&&r.destroy(),r=s.create("cardExpiry",{style:c,placeholder:o}),t.replaceWith('<div id="yith-stripe-card-expiry" class="yith-stripe-elements-field">'),r.mount("#yith-stripe-card-expiry"),r.on("change",i)),n.length&&(o=n.attr("placeholder"),void 0!==a&&a.destroy(),a=s.create("cardCvc",{style:c,placeholder:o}),n.replaceWith('<div id="yith-stripe-card-cvc" class="yith-stripe-elements-field">'),a.mount("#yith-stripe-card-cvc")))},b=function b(e,t){var n={form:u("#wc-yith-stripe-cc-form, #yith-stripe-cc-form").closest(".payment_method_yith-stripe"),unblock:u(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table, #add_payment_method, #order_review")};(t=u.extend(n,t)).unblock.removeClass("processing").unblock(),u(".woocommerce-error",t.form).remove(),e.error&&(u(".stripe-intent",t.form).remove(),e.error.message)&&(n=u("<ul>",{"class":"woocommerce-error"}).append(u("<li>",{text:e.error.message})),t.form.prepend(n),u("html, body").animate({scrollTop:n.offset().top}))},f=function f(e){var t,n,i,o,r,a,l,c,s,d,p,h,m;return u("input#payment_method_yith-stripe").is(":checked")&&0===u("input.stripe-intent").length?(t=u("#wc-yith-stripe-cc-form, #yith-stripe-cc-form"),n=u("form.checkout, form#order_review, form#add_payment_method"),i=u(".woocommerce-checkout-payment, .woocommerce-checkout-review-order-table, #add_payment_method"),h=u("#yith-stripe-card-name"),o=u("#billing_email"),r=u("#billing_country"),a=u("#billing_city:visible"),m=u("#billing_address_1:visible"),l=u("#billing_address_2:visible"),c=u("select#billing_state:visible, input#billing_state:visible"),d=(s=u("#billing_postcode:visible")).val(),p=u("#billing_phone:visible"),h=w({billing_details:{name:h.length?h.val():u("#billing_first_name").val()+" "+u("#billing_last_name").val(),address:{line1:m.length?m.val():"",line2:l.length?l.val():"",city:a.length?a.val():"",state:c.length?c.val():"",country:r.length?r.val():"",postal_code:s.length?d:""},email:o.length?o.val():"",phone:p.length?p.val():""}}),m=!(!(m=u('input[name="wc-yith-stripe-payment-token"]:checked')).length||"new"===m.val())&&m.val(),i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),m?(t.append('<input type="hidden" class="stripe-intent" name="stripe_intent" value=""/>'),i.unblock(),n.submit()):_.createPaymentMethod("card",y,h).then(function(e){e.error?b(e):(t.append('<input type="hidden" class="stripe-intent" name="stripe_intent" value=""/>'),t.append('<input type="hidden" class="stripe-payment-method" name="stripe_payment_method" value="'+e.paymentMethod.id+'"/>'),i.unblock(),n.submit())}),!1):e},v=function v(e){var t,n,i,o,r,a,l,c,s,d,p,h,m,f;return u("input#payment_method_yith-stripe").is(":checked")&&0===u("input.stripe-intent").length?(t=u("#wc-yith-stripe-cc-form, #yith-stripe-cc-form"),n=u("form#add_payment_method"),i=u("#add_payment_method"),o=u("#yith-stripe-card-name"),r=u("#billing_email"),a=u("#billing_country"),l=u("#billing_city:visible"),c=u("#billing_address_1:visible"),s=u("#billing_address_2:visible"),d=u("select#billing_state:visible, input#billing_state:visible"),p=w({payment_method_data:{billing_details:{name:o.length?o.val():u("#billing_first_name").val()+" "+u("#billing_last_name").val(),address:{line1:c.length?c.val():"",line2:s.length?s.val():"",city:l.length?l.val():"",state:d.length?d.val():"",country:a.length?a.val():""},email:r.length?r.val():""}},save_payment_method:!0}),f=!(!(f=u('input[name="wc-yith-stripe-payment-token"]:checked')).length||"new"===f.val())&&f.val(),i.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),g(f).then(function(e){return"undefined"==typeof e.res||e.res||"undefined"==typeof e.error?"undefined"!=typeof e.refresh&&e.refresh?(window.location.reload(),!1):(h=e.intent_id,m=e.intent_secret,void(f?(t.append('<input type="hidden" class="stripe-intent" name="stripe_intent" value="'+h+'"/>'),i.unblock(),n.submit()):_.handleCardSetup(m,y,p).then(function(e){e.error?b(e):(h=("undefined"!=typeof e.paymentIntent?e.paymentIntent:e.setupIntent).id,t.append('<input type="hidden" class="stripe-intent" name="stripe_intent" value="'+h+'"/>'),i.unblock(),n.submit())}))):(b(e),!1)}),!1):e},n=function n(){var e,t=window.location.hash.match(/^#?yith-confirm-pi-([^\/]+)\/(.+)$/);!t||t.length<3||(e=(t=P(t,3))[1],t=t[2],window.location.hash="",o(e,t))},o=function o(e,t){var n=u("form.checkout, form#order_review"),i=e.indexOf("seti")<0?"handleCardAction":"handleCardSetup";_[i](e).then(function(e){e.error?b(e,{unblock:n}):window.location=decodeURIComponent(t)})["catch"](function(e){e.log(e)})},e=function e(){u(".stripe-intent").remove(),u(".stripe-payment-method").remove()},t=function t(){var e=u("#payment").find("div.cards");e.length&&(e.siblings("fieldset#wc-yith-stripe-cc-form, fieldset#yith-stripe-cc-form").hide(),u("body").on("updated_checkout",function(){u("#payment").find("div.cards").siblings("fieldset#wc-yith-stripe-cc-form, fieldset#yith-stripe-cc-form").hide()}),u("form.checkout, form#order_review").on("change",'#payment input[name="wc-yith-stripe-payment-token"]',function(){var e=u(this),t=u("#payment").find("div.cards");t.find("div.card").removeClass("selected"),t.find('input[name="wc-yith-stripe-payment-token"]:checked').closest("div.card").addClass("selected"),"new"===e.val()?t.siblings("fieldset#wc-yith-stripe-cc-form, fieldset#yith-stripe-cc-form").show():t.siblings("fieldset#wc-yith-stripe-cc-form, fieldset#yith-stripe-cc-form").hide()}))},g=function g(e){var t=[];return yith_stripe_info.is_checkout&&!yith_stripe_info.order&&(t=u("form.checkout").serializeArray()),u.ajax({data:m(t,{action:"yith_stripe_refresh_intent",yith_stripe_refresh_intent:yith_stripe_info.refresh_intent,selected_token:e,is_checkout:yith_stripe_info.is_checkout,order:yith_stripe_info.order}),method:"POST",url:yith_stripe_info.ajaxurl})},p=function p(e){e.preventDefault();var t,n,i=u(this).attr("href"),e=/.*\/([0-9]*)\//gi.exec(i)[1];u("table.account-payment-methods-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),g(e).then(function(e){return"undefined"==typeof e.res||e.res||"undefined"==typeof e.error?"undefined"!=typeof e.refresh&&e.refresh?(window.location.reload(),!1):(t=e.intent_secret,void _.handleCardSetup(t).then(function(e){e.error?b(e,{form:u(".woocommerce-notices-wrapper"),unblock:u(".account-payment-methods-table")}):(n=e.setupIntent.id,window.location=i+"&stripe_intent="+n)})):(b(e),!1)})},h=function h(e){e.preventDefault();var t=u(this),n=u("<div/>",{"class":"yith-wcstripe-modal confirm-modal"}),e=u("<h3/>",{text:yith_stripe_info.labels.confirm_modal.title,"class":"modal-header"}),i=u("<p/>",{text:yith_stripe_info.labels.confirm_modal.body,"class":"modal-body"}),o=u("<div/>",{"class":"modal-footer"}),r=u("<a/>",{text:yith_stripe_info.labels.confirm_modal.cancel_button,"class":"cancel ghost button btn"}),a=u("<a/>",{text:yith_stripe_info.labels.confirm_modal.confirm_button,"class":"confirm delete-button button btn"});$closeButton=u("<a/>",{"class":"close-button",html:"&times;"}),o.append(r).append(a),n.append($closeButton).append(e).append(i).append(o),l.addClass("yith-wcstripe-modal-backdrop"),r.add($closeButton).on("click",function(){n.remove(),l.removeClass("yith-wcstripe-modal-backdrop")}),a.on("click",function(){var e=t.attr("href");n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),window.location.href=e}),l.append(n)},i=function i(){"undefined"!=typeof u.fn.prettyPhoto&&u(".woocommerce #payment ul.payment_methods li, form#add_payment_method").find("a.cvv2-help").prettyPhoto({hook:"data-rel",social_tools:!1,theme:"pp_woocommerce",horizontal_padding:20,opacity:.8,deeplinking:!1})},w=function w(e){var t,n,i={};if("object"!=x(e))return e;for(t in e)e.hasOwnProperty(t)&&(n="object"==x(e[t])?w(e[t]):e[t])&&!u.isEmptyObject(n)&&(i[t]=n);return i},m=function m(e,t){for(var n in t)t.hasOwnProperty(n)&&e.push({name:n,value:t[n]});return e},k=function k(){u("table.account-payment-methods-table").on("click",".confirm",p),u("table.account-payment-methods-table").on("click",".delete",h),u("body").hasClass("yith-wcstripe-custom-payment-method-table")&&u("table.account-payment-methods-table").find(".payment-method-actions .button").on("mouseenter",function(){var e=u(this),t=u("<span/>",{text:e.text(),"class":"yith-wcstripe-tooltip"});e.append(t)}).on("mouseleave",function(){u(this).find(".yith-wcstripe-tooltip").remove()}),(u(yith_stripe_info.elements_container_id).length||u("#yith-stripe-card-number").length)&&(d(),i(),t(),n(),y.addEventListener("change",b),window.addEventListener("hashchange",n),l.on("updated_checkout",d),l.on("updated_checkout",i),l.on("checkout_error",e),u("form.checkout").on("checkout_place_order_yith-stripe",f),u("form#order_review").on("submit",f),u("form#add_payment_method").on("submit",v),u("form.checkout, form#order_review, form#add_payment_method").on("change","#wc-yith-stripe-cc-form input, #yith-stripe-cc-form input",e))},u(document).on("ywsbs-auto-renew-opened",k),k();var I,A=window;for(I in C)A[I]=C[I];C.__esModule&&Object.defineProperty(A,"__esModule",{value:!0})})();