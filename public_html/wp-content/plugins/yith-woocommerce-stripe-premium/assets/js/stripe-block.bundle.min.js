(()=>{"use strict";var r={d:(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},e={};function n(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,l=[],s=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=o.call(n)).done)&&(l.push(r.value),l.length!==t);s=!0);}catch(e){c=!0,i=e}finally{try{if(!s&&null!=n["return"]&&(a=n["return"](),Object(a)!==a))return}finally{if(c)throw i}}return l}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||n(e,t)||function(e,t){var n;if(e)return"string"==typeof e?i(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){e=function(e,t){if("object"!==a(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(n===undefined)return("string"===t?String:Number)(e);if("object"!==a(e=n.call(e,t||"default")))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===a(e)?e:String(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function c(e,t,n){(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}r.r(e),r.d(e,{"default":()=>h});const u=window.wp.element;function m(e,t){var n,r,i,o,a,l="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(l)return r=!(n=!0),{s:function(){l=l.call(e)},n:function(){var e=l.next();return n=e.done,e},e:function(e){r=!0,i=e},f:function(){try{n||null==l["return"]||l["return"]()}finally{if(r)throw i}}};if(Array.isArray(e)||(l=function(e,t){var n;if(e)return"string"==typeof e?f(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return l&&(e=l),o=0,{s:a=function a(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var t,h=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");c(this,"elementComponents",{}),c(this,"elementNodes",{}),c(this,"billing",void 0),this.onPaymentProcessing=this.onPaymentProcessing.bind(this),this.afterElementsSubmit=this.afterElementsSubmit.bind(this),this.openIntentModal=this.openIntentModal.bind(this),this.onHashChange=this.onHashChange.bind(this),this.init()}var t,n,r;return t=e,(n=[{key:"init",value:function(){this.registerMethod(),this.initStripe(),this.initHashChange()}},{key:"initStripe",value:function(){var e=yith_stripe_info.public_key;e&&(this.stripe=Stripe(e))}},{key:"initHashChange",value:function(){window.addEventListener("hashchange",this.onHashChange),this.onHashChange()}},{key:"getMethod",value:function(){var e=yith_stripe_info,t=e.slug,e=e.title,n=this.getLabel(),r=this.getContent();return{name:t,label:React.createElement(n,null),content:React.createElement(r,null),edit:React.createElement(r,null),canMakePayment:function(){return!0},ariaLabel:e}}},{key:"getLabel",value:function(){return function(e){var e=e.components.PaymentMethodLabel,t=yith_stripe_info.title;return React.createElement(e,{text:t})}}},{key:"getContent",value:function(){var i=this,e=yith_stripe_info,o=e.slug,a=e.description;return function(e){var t=e.billing,n=e.activePaymentMethod,r=e.eventRegistration.onPaymentProcessing;if(o===n)return i.billing=t,(0,u.useEffect)(function(){i.initElements()}),(0,u.useEffect)(function(){return r(i.onPaymentProcessing)},[r]),React.createElement(React.Fragment,null,a?React.createElement("p",{dangerouslySetInnerHTML:{__html:a}}):null,i.getForm())}}},{key:"getForm",value:function(){var r=this,e=yith_stripe_info.mode,t=this.getElements();if("hosted"!==e)return React.createElement("div",{className:"yith-stripe-form-container ".concat(e)},this.getNameOnCardField(),t.map(function(e){var t=(0,u.useRef)(),n="yith-stripe-"+e.replace(/([A-Z])/g,"-$1").toLowerCase();return r.elementNodes[e]=t,React.createElement("div",{key:e,className:r.getElementClasses(e)},React.createElement("label",null,r.getElementLabel(e)),React.createElement("div",{id:n,ref:t,className:"yith-stripe-elements-field"}))}))}},{key:"getNameOnCardField",value:function(){var e;if(yith_stripe_info.show_name_on_card)return e=(0,u.useRef)(),this.elementNodes.nameOnCard=e,React.createElement("div",{className:"form-row form-row-wide"},React.createElement("label",null,this.getElementLabel("nameOnCard")),React.createElement("input",{id:"yith-stripe-name-on-card",className:"yith-stripe-elements-field",type:"text",ref:e,placeholder:this.getElementPlaceholder("nameOnCard")}))}},{key:"registerMethod",value:function(){(0,wc.wcBlocksRegistry.registerPaymentMethod)(this.getMethod())}},{key:"onError",value:function(e){return{type:"failure",message:e.message}}},{key:"onPaymentProcessing",value:function(){return this.submitElements()}},{key:"onHashChange",value:function(){var e,t=window.location.hash.match(/^#?yith-confirm-pi-([^:]+)\/(.+)$/);!t||t.length<3||(e=(t=o(t,3))[1],t=t[2],window.location.hash="",this.openIntentModal(e,t))}},{key:"openIntentModal",value:function(e,t){var n=this,r=e.indexOf("seti")<0?"handleCardAction":"handleCardSetup";this.stripe[r](e).then(function(e){e.error&&n.onError(e.error),e.error||(window.location=decodeURIComponent(t))})["catch"](function(e){return e.log(e)})}},{key:"initElements",value:function(){this.stripe&&"hosted"!==yith_stripe_info.mode&&(this.elements||(this.elements=this.stripe.elements(),this.createElements()),this.mount())}},{key:"createElements",value:function(){var e=yith_stripe_info.show_zip,t=this.getElementsStyle();if(this.elements){var n=this.getElements();if(n){var r,i=m(n);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getElementPlaceholder(o);this.elementComponents[o]=this.elements.create(o,{style:t,placeholder:a,showIcon:!0,hidePostalCode:!e})}}catch(l){i.e(l)}finally{i.f()}}}}},{key:"submitElements",value:function(){if(this.stripe&&this.elements)return this.elements.submit().then(this.afterElementsSubmit)["catch"](this.onError)}},{key:"afterElementsSubmit",value:function(){var n=this,e=yith_stripe_info.mode;return this.stripe.createPaymentMethod("card",this.elementComponents["standard"===e?"cardNumber":"card"],{billing_details:this.getBillingDetails()}).then(function(e){var t=e.error,e=e.paymentMethod;return t?n.onError(t):{type:"success",meta:{paymentMethodData:{stripe_payment_method:e.id}}}})["catch"](this.onError)}},{key:"mount",value:function(){for(var e=0,t=Object.entries(this.elementComponents);e<t.length;e++){var n=o(t[e],2),r=n[0],n=n[1],r=this.getElementNode(r);r&&n.mount(r)}}},{key:"unmount",value:function(){var e,t=m(this.elementComponents);try{for(t.s();!(e=t.n()).done;)e.value.unmount()}catch(n){t.e(n)}finally{t.f()}}},{key:"getBillingDetails",value:function(){var e=this.billing.billingAddress,t=this.getElementNode("nameOnCard"),n="".concat(e.first_name," ").concat(e.last_name);return{name:n=t?t.value:n,email:null==e?void 0:e.email,phone:null==e?void 0:e.phone,address:{country:null==e?void 0:e.country,city:null==e?void 0:e.city,line1:null==e?void 0:e.address_1,line2:null==e?void 0:e.address_2,postal_code:null==e?void 0:e.postcode,state:e.state}}}},{key:"getElements",value:function(){var e;switch(yith_stripe_info.mode){case"elements":e=["card"];break;case"standard":e=["cardNumber","cardExpiry","cardCvc"]}return e}},{key:"getElementsStyle",value:function(){var e=yith_stripe_info;return{base:{backgroundColor:e.background_color,fontSize:e.font_size,color:e.color,iconColor:e.icon_color,fontFamily:e.font_family,"::placeholder":{color:e.placeholder_color}},invalid:{iconColor:e.invalid_icon_color,color:e.invalid_color},complete:{color:e.complete_color}}}},{key:"getElementNode",value:function(e){var t;return null!=(t=this.elementNodes)&&t[e]?null==(t=this.elementNodes[e])?void 0:t.current:null}},{key:"getElementLabel",value:function(e){var t=(null==(t=yith_stripe_info)?void 0:t.labels).fields,e=e.replace(/([A-Z])/g,"-$1").toLowerCase();return t&&null!=t&&t[e]?null==t?void 0:t[e].label:""}},{key:"getElementPlaceholder",value:function(e){var t=(null==(t=yith_stripe_info)?void 0:t.labels).fields,e=e.replace(/([A-Z])/g,"-$1").toLowerCase();return t&&null!=t&&t[e]?null==t?void 0:t[e].placeholder:""}},{key:"getElementClasses",value:function(e){var t=["form-row"];if(window.matchMedia("(max-width: 768px)").matches)t.push("form-row-wide");else switch(e){case"card":case"cardNumber":t.push("form-row-wide");break;case"cardExpiry":t.push("form-row-first");break;case"cardCvc":t.push("form-row-last")}return t.join(" ")}}])&&s(t.prototype,n),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),d=("undefined"!=typeof wc&&new h,window);for(t in e)d[t]=e[t];e.__esModule&&Object.defineProperty(d,"__esModule",{value:!0})})();